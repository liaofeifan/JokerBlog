<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="wangzhizhou">
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>Installation of Ubuntu 16.04 On UDisk - Joker's Blog</title>
        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.5.0.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../../css/highlight.css">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
	
	<script src="../../js/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/highlight.pack.js"></script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="../..">Joker's Blog</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                    <li >
                        <a href="../..">About Me</a>
                    </li>
                    <li >
                        <a href="../../How I create this blog/">Create your own blog as me</a>
                    </li>
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Z-turn <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../Network Simulator 2 Installation Guide for Ubuntu/">Network Simulator 2 Installation Guide for Ubuntu</a>
</li>
                            
<li >
    <a href="../Learn STL In 30 Minutes/">Learn STL In 30 Minutes</a>
</li>
                            
<li class="active">
    <a href="./">Installation of Ubuntu 16.04 On UDisk</a>
</li>
                            
<li >
    <a href="../Configure Git Server With Ubuntn and Apache 2/">Configure Git Server With Ubuntn and Apache 2</a>
</li>
                            
<li >
    <a href="../Add Watermark on Video with OpenCV and FFmpeg/">Add Watermark on Video with OpenCV and FFmpeg</a>
</li>
                            
<li >
    <a href="../Develop DLNA Using Platinum Library/">Develop DLNA Using Platinum Library</a>
</li>
                            
<li >
    <a href="../FFmpeg and SDL tutorial 1/">FFmpeg and SDL tutorial 1</a>
</li>
                            
<li >
    <a href="../FFmpeg compiled on MacOS/">FFmpeg compiled on MacOS</a>
</li>
                            
<li >
    <a href="../FFmpeg version 3.1.4 example code/">FFmpeg version 3.1.4 example code</a>
</li>
                            
<li >
    <a href="../Fmpeg 2.8.6 example code - transcoding/">Fmpeg 2.8.6 example code   transcoding</a>
</li>
                            
<li >
    <a href="../Nmap Basics/">Nmap Basics</a>
</li>
                            
<li >
    <a href="../Use GDB/">Use GDB</a>
</li>
                            
<li >
    <a href="../User OpenCV to add watermark on a video/">User OpenCV to add watermark on a video</a>
</li>
                            
<li >
    <a href="../Wireshark Basics/">Wireshark Basics</a>
</li>
                            
<li >
    <a href="../Optimizing App Startup Time/">Optimizing App Startup Time</a>
</li>
                            
<li >
    <a href="../OpenVPN on Raspberry Pi/">OpenVPN on Raspberry Pi</a>
</li>
                            
<li >
    <a href="../swift on client and server/">Swift on client and server</a>
</li>
                            
<li >
    <a href="../my hardware/">My hardware</a>
</li>
                            
<li >
    <a href="../kotlin/">Kotlin</a>
</li>
                            
<li >
    <a href="../Convert MP4 to GIF With FFmpeg/">Convert MP4 to GIF With FFmpeg</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">etc <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../../life/alipay-scan-fu-icon/">Alipay scan fu icon</a>
</li>
                            
<li >
    <a href="../../life/Renting in Beijing/">Renting in Beijing</a>
</li>
                            
<li >
    <a href="../../life/Gu Bei Shui Zhen/">Gu Bei Shui Zhen</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Music <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../../music/whistle/">Whistle</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Game <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../../minecraft/minecraft/">Minecraft</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Me <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../../me/English Personal Resume/">English Personal Resume</a>
</li>
                            
<li >
    <a href="../../me/My Plan for finding Job/">My Plan for finding Job</a>
</li>
                            
<li >
    <a href="../../me/Personal Pre-Work Record/">Personal Pre Work Record</a>
</li>
                            
<li >
    <a href="../../me/My Financial Planning/">My Financial Planning</a>
</li>
                            
<li >
    <a href="../../me/Life in Beijing/">Life in Beijing</a>
</li>
                            
<li >
    <a href="../../me/jokerhub/">Jokerhub</a>
</li>
                        </ul>
                    </li>
                </ul>

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                    <li >
                        <a rel="next" href="../Learn STL In 30 Minutes/">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../Configure Git Server With Ubuntn and Apache 2/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
                    <li>
                        <a href="https://github.com/wangzhizhou/JokerBlog">
                                <i class="fa fa-github"></i>GitHub
                        </a>
                    </li>
            </ul>
        </div>
    </div>
</div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#installation-of-ubuntu-1604-on-udisk">Installation of Ubuntu 16.04 On UDisk</a></li>
            <li><a href="#ubuntu-1604">安装Ubuntu 16.04</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="installation-of-ubuntu-1604-on-udisk">Installation of Ubuntu 16.04 On UDisk</h1>
<h3 id="ubuntu-1604">安装Ubuntu 16.04</h3>
<p>我是在Mac电脑下工作的，首先需要制作一个U盘安装盘。因为Mac电脑是通过UEFI引导的，所以需要将U盘分区为GUID格式的，当然如果你不是在Mac下工作，就不必分区为GUID了，这样分区只是为了让UEFI可以在引导菜单中显示制作好的U盘安装盘。</p>
<p>在Mac下制U盘安装盘，首先要将下载好的IOS镜像文件转化成为IMG格式，假设我的Ubuntu系统IOS文件名为：<strong>ubuntu-16.04-desktop-i386.iso</strong>, 使用如下命令进行格式转化:</p>
<pre><code>localhost:Downloads wangzhizhou$  hdiutil convert -format UDRW -o ubuntu-16.04-desktop-i386.img ubuntu-16.04-desktop-i386.iso
</code></pre>

<p>转化后的文件名为：<code>ubuntu-16.04-desktop-i386.img.dmg</code>，这个其实名字没什么关系，重要的是镜像的内容按照Mac可识别的格式得到了转化，之后我们就将转化后的文件写入U盘。</p>
<p>写入U盘前，首先要找到U盘，我们使用<code>diskutil list</code>将当前插入电脑的所有磁盘显示出来，找出我们想要写入的那个,我这里显示如下：</p>
<pre><code>localhost:Downloads wangzhizhou$ diskutil list
/dev/disk0 (internal, physical):
   #:                       TYPE NAME                    SIZE       IDENTIFIER
   0:      GUID_partition_scheme                        *121.3 GB   disk0
   1:                        EFI EFI                     209.7 MB   disk0s1
   2:          Apple_CoreStorage Macintosh HD            120.5 GB   disk0s2
   3:                 Apple_Boot Recovery HD             650.0 MB   disk0s3
/dev/disk1 (internal, virtual):
   #:                       TYPE NAME                    SIZE       IDENTIFIER
   0:                  Apple_HFS Macintosh HD           +120.1 GB   disk1
                                 Logical Volume on disk0s2
                                 DA03CC12-7D54-44AA-ADC8-424073352296
                                 Unlocked Encrypted
/dev/disk2 (external, physical):
   #:                       TYPE NAME                    SIZE       IDENTIFIER
   0:      GUID_partition_scheme                        *61.9 GB    disk2
   1:                        EFI EFI                     209.7 MB   disk2s1
   2:                  Apple_HFS                         61.6 GB    disk2s2
</code></pre>

<p>从上面看出，我要写入的U盘是<code>/dev/disk2</code>,因为它是外部物理盘，并磁盘大小与我的U盘大小一致，64GB左右。我已经使用磁盘工具把它格式化成GUID分区，所以支持UEFI引导。</p>
<p>我们先用命令把U盘推出，这样也能进行写入操作，因为我们是写入系统镜像，如果不推出就写入的话，不能写到磁盘的最开始部分，也就无法进行引导。我U盘的挂载点为<code>/Volumes/Ubuntu/</code>，所以使用如下命令：</p>
<pre><code>localhost:Downloads wangzhizhou$ diskutil unmount /Volumes/Ubuntu/
Volume Ubuntu on disk2s2 unmounted
</code></pre>

<p>既然U盘已从挂载点卸载，我们就可以写入系统镜像文件了，注意是转化后的文件<code>ubuntu-16.04-desktop-i386.img.dmg</code>:</p>
<pre><code>localhost:Downloads wangzhizhou$ sudo dd if=ubuntu-16.04-desktop-i386.img.dmg of=/dev/rdisk2 bs=1024m
Password:
1+1 records in
1+1 records out
1504051200 bytes transferred in 96.270441 secs (15623188 bytes/sec)
</code></pre>

<p>注意，我们使用了<code>/dev/rdisk2</code>作为写入的目标磁盘，rdisk2对应于disk2，通常使用它能够以更快的速度写入U盘，r代表removeable，即可移动磁盘的意思。</p>
<p>现在我们重启Mac，并在重启过程中按下<code>option</code>不放直到启动菜单出现我们的U盘安装盘，如果没有出现，说明没有制作成功，一定是哪个环节没有按步骤来，需要重头来一遍。注意U盘要插在电脑上。</p>
<pre><code>localhost:Downloads wangzhizhou$ sudo reboot
</code></pre>

<p>重启电脑</p>
<p>之后就是正常的安装Ubuntu了，自己去摸索吧～</p>
<p>我靠，开机后居然不能引导，经过不断的百度，有网友称Ubuntu只对64位版本提供UEFI引导模式，呜呼，又得重新来一遍。先下载一个64位版的Ubuntu安装镜像，然后再重新来一次吧。如果使用传统BIOS引导完全不存在这种情况。</p>
<p><strong>这次文件名为：<code>ubuntu-16.04-desktop-amd64.iso</code>,就不一一说明了，直接贴命令行：</strong></p>
<pre><code>localhost:Downloads JokerAtBaoFeng$ diskutil list
/dev/disk0 (internal, physical):
   #:                       TYPE NAME                    SIZE       IDENTIFIER
   0:      GUID_partition_scheme                        *251.0 GB   disk0
   1:                        EFI EFI                     209.7 MB   disk0s1
   2:          Apple_CoreStorage Macintosh HD            250.1 GB   disk0s2
   3:                 Apple_Boot Recovery HD             650.0 MB   disk0s3
/dev/disk1 (internal, virtual):
   #:                       TYPE NAME                    SIZE       IDENTIFIER
   0:                  Apple_HFS Macintosh HD           +249.8 GB   disk1
                                 Logical Volume on disk0s2
                                 3B2115D8-1852-411F-9052-ABA876FD6128
                                 Unencrypted
/dev/disk2 (external, physical):
   #:                       TYPE NAME                    SIZE       IDENTIFIER
   0:      GUID_partition_scheme                        *61.9 GB    disk2
   1:                        EFI EFI                     209.7 MB   disk2s1
   2:                  Apple_HFS Ubuntu16.04_64          61.6 GB    disk2s2
localhost:Downloads JokerAtBaoFeng$ diskutil unmountDisk /dev/disk2
Unmount of all volumes on disk2 was successful
localhost:Downloads JokerAtBaoFeng$ hdiutil convert -format UDRW -o ubuntu-16.04-desktop-amd64 ubuntu-16.04-desktop-amd64.iso
正在读取Driver Descriptor Map（DDM：0）…
正在读取Ubuntu 16.04 LTS amd64          （Apple_ISO：1）…
正在读取Apple（Apple_partition_map：2）…
正在读取Ubuntu 16.04 LTS amd64          （Apple_ISO：3）…
..............................................................................
正在读取EFI（Apple_HFS：4）…
..............................................................................
正在读取Ubuntu 16.04 LTS amd64          （Apple_ISO：5）…
..............................................................................
已耗时： 3.304s
速度：428.8M 字节/秒
节省：0.0%
created: /Users/JokerAtBaoFeng/Downloads/ubuntu-16.04-desktop-amd64.dmg
localhost:Downloads JokerAtBaoFeng$ sudo dd if=ubuntu-16.04-desktop-amd64.dmg of=/dev/rdisk2 bs=1024m
Password:
1+1 records in
1+1 records out
1485881344 bytes transferred in 95.220324 secs (15604666 bytes/sec)
</code></pre>

<p>系统镜像写入完成后，会弹出一个对话框，选择忽略即可。这次应该可以了，64位Ubuntu支持UEFI启动，并且我们的U盘已经按GUID分区方案分过区，现在重启Mac，并按住<code>option</code>不放即可。启动菜单这次会弹出U盘安装盘选项了。</p>
<p>哦这里又出现问题了，按住<code>option</code>重启后依然没有引导项，这是因为安装过程中，EFI引导文件被安装到了系统磁盘的EFI分区了，我们需要把那个文件拷到安装系统的U盘上的那个EFI分区。我们进入Mactonish HD，启动OS X，在命令行中把所有磁盘都列出来：</p>
<pre><code>localhost:ubuntu wangzhizhou$ diskutil list
/dev/disk0 (internal, physical):
   #:                       TYPE NAME                    SIZE       IDENTIFIER
   0:      GUID_partition_scheme                        *121.3 GB   disk0
   1:                        EFI EFI                     209.7 MB   disk0s1
   2:          Apple_CoreStorage Macintosh HD            120.5 GB   disk0s2
   3:                 Apple_Boot Recovery HD             650.0 MB   disk0s3
/dev/disk1 (internal, virtual):
   #:                       TYPE NAME                    SIZE       IDENTIFIER
   0:                  Apple_HFS Macintosh HD           +120.1 GB   disk1
                                 Logical Volume on disk0s2
                                 DA03CC12-7D54-44AA-ADC8-424073352296
                                 Unlocked Encrypted
/dev/disk2 (external, physical):
   #:                       TYPE NAME                    SIZE       IDENTIFIER
   0:      GUID_partition_scheme                        *62.6 GB    disk2
   1:                        EFI NO NAME                 499.1 MB   disk2s1
   2:        Bios Boot Partition                         127.9 MB   disk2s2
   3:                 Linux Swap                         4.1 GB     disk2s3
   4:           Linux Filesystem                         57.9 GB    disk2s4
</code></pre>

<p>我们将EFI分区：<code>/dev/disk0s1</code>和<code>/dev/disk2s1</code>都挂载到路径<code>/Volumes</code>下，使用下面的命令：</p>
<pre><code>localhost:~ wangzhizhou$ diskutil mount /dev/disk0s1;diskutil mount /dev/disk2s1
Volume EFI on /dev/disk0s1 mounted
Volume NO NAME on /dev/disk2s1 mounted
localhost:~ wangzhizhou$ ls /Volumes/
EFI     Macintosh HD    NO NAME
localhost:NO NAME wangzhizhou$ ls /Volumes/EFI/ /Volumes/NO\ NAME/
/Volumes/EFI/:
EFI

/Volumes/NO NAME/:
</code></pre>

<p><code>/Volumes</code>下<code>EFI</code>和<code>NO NAME</code>目录就是两个EFI分区的挂载点，你发现<code>/Volumes/NO NAME/</code>目录下面什么也没有，这就是为什么U盘系统盘已经安装成功了却没法引导。因为它们错误的安装在了<code>/dev/disk0s1</code>下了,也就是挂载点<code>/Volumes/EFI</code>下了,我们需要把这些文件复制到<code>/Volumes/NO NAME/</code>,下，并作一些调整，用命令行说明吧，文字有点不太清楚了：</p>
<pre><code>localhost:NO NAME wangzhizhou$ cp -r /Volumes/EFI/* /Volumes/NO\ NAME/
localhost:EFI wangzhizhou$ cd /Volumes/NO\ NAME/EFI/
localhost:EFI wangzhizhou$ ls
APPLE   ubuntu
localhost:EFI wangzhizhou$ pwd
/Volumes/NO NAME/EFI
localhost:EFI wangzhizhou$ rm -rf APPLE/
localhost:EFI wangzhizhou$ mkdir boot
localhost:EFI wangzhizhou$ cp ubuntu/grubx64.efi boot/bootx64.efi
localhost:EFI wangzhizhou$ cd /Volumes/EFI/EFI/
localhost:EFI wangzhizhou$ ls
APPLE   ubuntu
localhost:EFI wangzhizhou$ rm -rf ubuntu/
localhost:EFI wangzhizhou$ cd /Volumes/
localhost:Volumes wangzhizhou$ diskutil umount EFI;diskutil umount NO\ NAME/
Volume EFI on disk0s1 unmounted
Unmount successful for NO NAME/
</code></pre>

<p>好了我们的系统U盘上的EFI分区已经有了引导信息，这次按住<code>option</code>并重启应该能够引导Ubuntu启动了。</p>
<pre><code>localhost:Volumes wangzhizhou$ sudo reboot
</code></pre></div>
        </div>

        <footer class="col-md-12">
            <hr>
                <p>created by wangzhizhou</p>
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>var base_url = '../..';</script>
        <script data-main="../../mkdocs/js/search.js" src="../../mkdocs/js/require.js"></script>
        <script src="../../js/base.js"></script><div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
